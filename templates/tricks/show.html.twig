{% extends 'base.html.twig' %}

{% block body %}
    <section class="comments">
    {% for comment in tricks.comments %}
        <div>
            {{ comment.content }}
            {% if is_granted('COMMENT_ACCESS', comment) %}
                <button data-toggle="modal" data-target="#editCommentModal" data-comment-id="{{ comment.id }}" data-tricks-slug="{{ tricks.slug }}" class="edit-button"><i class="bi-pencil-fill text-primary"></i></button>
                <form method="POST"
                      action="{{ path('app_tricks_deleteComment', {id: comment.id, slug: tricks.slug}) }}"
                      onsubmit="return confirm('{% trans %}Are you really sure you want to delete this comment?{% endtrans %}')">
                    <input type="hidden" name="_method" value="DELETE">
                    <input type="hidden" name="_token" id="csrf_token[{{ comment.id }}]"
                           value="{{ csrf_token('delete-comment-' ~ comment.id) }}">
                    <button type="submit" class="button-no-decoration">
                        <i class="bi bi-trash-fill text-danger p-1"></i>
                    </button>
                </form>
            {% endif %}
        </div>
    {% endfor %}
    </section>
    <div class="modal" tabindex="-1" id="successModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-success-subtle">
                <div class="modal-body">
                    <p>Votre message a bien été édité.</p>
                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="editCommentModal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modifier le commentaire</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="editCommentModalBody"></div>
                </div>
            </div>
        </div>
    </div>
    {% if app.user %}
        <a href="{{ path('app_tricks_edit', {slug: tricks.slug}) }}">edit</a>
        <form method="POST"
              action="{{ path('app_tricks_delete', {slug: tricks.slug}) }}"
              onsubmit="return confirm('{% trans %}Are you really sure you want to delete this tricks?{% endtrans %}')">
            <input type="hidden" name="_method" value="DELETE">
            <input type="hidden" name="_token" id="csrf_token[{{ tricks.slug }}]"
                   value="{{ csrf_token('delete-tricks-' ~ tricks.slug) }}">
            <button type="submit" class="button-no-decoration">
                <i class="bi bi-trash-fill text-danger p-1"></i>
            </button>
        </form>
        {{ include('comment/_form.html.twig',{ 'button_label': 'Register'} ) }}
    {% else %}
        Pour pouvoir laisser un commentaire merci de vous connecter !
    {% endif %}
{% endblock %}

{% block title %}
    {{ tricks }}
{% endblock %}
